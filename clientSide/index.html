<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="content-styles.css">
  <link rel="icon" type="image/x-icon" href="TWIST_logo.png">
  <title>TWIST for the Quantitative Study</title>
</head>
<body onload="initialize()">
  <h1>Fake Twitter</h1>
  <p class="firstPage"> Welcome to Part B of the study.  A prompt will be given and you will write a post responding to that situation to the best of your ability.  Your responses should not include any personal information and should be fictional, but try to connect to the prompt as much as possible. <br> <br> Please click the button to consent and continue the study. </p>
  <p class="breakPage" style="display: block; opacity: 0;"> You have finished responding to this prompt.  Click the button below to continue to the next prompt. </p>
  <button class="resumePromptsButton action_btn"> Continue </button>
  <p class="prompt" id="promptText" style="display: block; opacity: 0;">Write a tweet about ____:</p>
  <div class="twitterBoxName" style="display: block; opacity: 0;">
    <div>
      <textarea id="textInput" rows="22" cols="75" placeholder="Enter your Tweet text here..."></textarea>
      <button class="twitterPostButton action_btn">Post My Tweet</button>
    </div>
  </div>
  <p id="response" style="display: block; opacity: 0;"></p>

  <script type="text/javascript" src="prompts.js"></script>
  <script type="text/javascript" src="twist.js"></script>
  <script>
    // Extract dataset parameters from URL
    const urlParams = new URLSearchParams(window.location.search);
    const PROLIFIC_ID = urlParams.get('PROLIFIC_ID');
    const lastDataset = urlParams.get('lastDataset');
    let currDataset = urlParams.get('currDataset');
    let nextDataset; //= urlParams.get('nextDataset');

    let datasets = [1, 2, 3];

    function removeItemOnce(arr, value) {
      value = Number(value);
      var index = arr.indexOf(value);
      if (index > -1) {
        arr.splice(index, 1);
      }
      console.log("arr: " + arr);
      return arr;
    }

    function shuffleArray(array) {
      array = array.sort(() => Math.random() - 0.5); // Shuffle the array
      return array;
    }

    if ((lastDataset == null) || (lastDataset != 1 && lastDataset != 2 && lastDataset != 3)) {
      console.error("ERROR: Invalid lastDataset value");
      throw new Error("Invalid lastDataset value");
    }

    if (currDataset == null || currDataset == 0) {
      console.log(datasets);
      removeItemOnce(datasets, lastDataset);
      console.log(datasets);
      shuffleArray(datasets);
      console.log(datasets);
      if (currDataset != 0) { //this allows me to bypass 10/12 prompts when testing
        currDataset = datasets[0];
      }
      nextDataset = datasets[1];
    }

    function initialize() {
        initializePrompts(currDataset)
          .then(() => {
            const prompt = getNextPrompt();
            document.getElementById("promptText").textContent = prompt;
          })
          .catch((error) => console.error("Error initializing prompts:", error));
        
        buildTwistApp(nextDataset, PROLIFIC_ID);
    }
  </script>
  <script>
    const firstPageContainer = document.querySelector(".firstPage");
    const breakPageContainer = document.querySelector(".breakPage");
    const continueButton = document.querySelector(".resumePromptsButton");
    const promptContainer = document.getElementById("promptText");
    const twistAppContainer = document.querySelector(".twitterBoxName");

    continueButton.addEventListener("click", function () {
        // Hide break page and continue with the next prompt
        firstPageContainer.style.display = "none";
        firstPageContainer.style.opacity = "0";

        breakPageContainer.style.display = "none";
        breakPageContainer.style.opacity = "0";

        continueButton.style.display = "none";
        continueButton.style.opacity = "0";

        promptContainer.style.display = "block";
        promptContainer.style.opacity = "1";

        twistAppContainer.style.display = "flex";
        twistAppContainer.style.opacity = "1";
    });
  </script>
</body>
</html>
