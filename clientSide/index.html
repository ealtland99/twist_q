<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="content-styles.css">
  <link rel="icon" type="image/x-icon" href="TWIST_logo.png">
  <title>TWIST for the Quantitative Study</title>
</head>
<body onload="initialize()">
  <h1>Fake Twitter</h1>
  <div class="firstPageBox">
    <p> Welcome to Part B of the study.  A prompt will be given and you will write a post responding to that situation to the best of your ability.  Your responses should not include any personal information and should be fictional, but try to connect to the prompt as much as possible. <br> <br> Please enter your Prolific ID, then click the button to consent and continue the study. </p>
    <textarea id="prolificIDinput" rows="1" cols="10"></textarea>
  </div>
  <p class="breakPage" style="display: block; opacity: 0;"> You have finished responding to this prompt.  Click the button below to continue to the next prompt. </p>
  <button class="resumePromptsButton action_btn"> Continue </button>
  <p class="prompt" id="promptText" style="display: block; opacity: 0;">Write a tweet about ____:</p>
  <div class="twitterBoxName" style="display: block; opacity: 0;">
    <div>
      <textarea id="textInput" rows="22" cols="75" placeholder="Enter your Tweet text here..."></textarea>
      <button class="twitterPostButton action_btn">Post My Tweet</button>
    </div>
  </div>
  <p id="response" style="display: block; opacity: 0;"></p>

  <script type="text/javascript" src="prompts.js"></script>
  <script type="text/javascript" src="twist.js"></script>
  <script>
    // Extract dataset parameters from URL
    const urlParams = new URLSearchParams(window.location.search);
    const lastDataset = urlParams.get('lastDataset');
    let currDataset = urlParams.get('currDataset');
    let nextDataset;

    let datasets = [1, 2, 3];

    function removeItemOnce(arr, value) {
      value = Number(value);
      var index = arr.indexOf(value);
      if (index > -1) {
        arr.splice(index, 1);
      }
      return arr;
    }

    function shuffleArray(array) {
      array = array.sort(() => Math.random() - 0.5); // Shuffle the array
      return array;
    }

    if ((lastDataset == null) || (lastDataset != 1 && lastDataset != 2 && lastDataset != 3)) {
      console.error("ERROR: Invalid lastDataset value");
      throw new Error("Invalid lastDataset value");
    }

    if (currDataset == null || currDataset == 0) {
      removeItemOnce(datasets, lastDataset);
      shuffleArray(datasets);
      if (currDataset != 0) { //this allows me to bypass 10/12 prompts when testing
        currDataset = datasets[0];
      }
      nextDataset = datasets[1];
    }

    function initialize() {
      initializePrompts(currDataset)
        .then(() => {
          const prompt = getNextPrompt();
          document.getElementById("promptText").textContent = prompt;
        })
        .catch((error) => console.error("Error initializing prompts:", error));

      // Check if Prolific ID is present in URL params
      const PROLIFIC_ID_URL = urlParams.get('PROLIFIC_ID');
      if (PROLIFIC_ID_URL) {
        // If Prolific ID is present, fill the textbox with it
        document.getElementById("prolificIDinput").value = PROLIFIC_ID_URL;
      }
    }
  
    const firstPageContainer = document.querySelector(".firstPageBox");
    const breakPageContainer = document.querySelector(".breakPage");
    const continueButton = document.querySelector(".resumePromptsButton");
    const promptContainer = document.getElementById("promptText");
    const twistAppContainer = document.querySelector(".twitterBoxName");

    continueButton.addEventListener("click", function () {
      let PROLIFIC_ID = document.getElementById("prolificIDinput").value;
      PROLIFIC_ID = PROLIFIC_ID.trim();
      if (PROLIFIC_ID == "") {
        console.error("ERROR: Invalid Prolific ID value");
        throw new Error("Invalid Prolific ID value");
      }

      buildTwistApp(nextDataset, PROLIFIC_ID);

      // Hide break page and continue with the first prompt
      firstPageContainer.style.display = "none";
      firstPageContainer.style.opacity = "0";

      breakPageContainer.style.display = "none";
      breakPageContainer.style.opacity = "0";

      continueButton.style.display = "none";
      continueButton.style.opacity = "0";

      promptContainer.style.display = "block";
      promptContainer.style.opacity = "1";

      twistAppContainer.style.display = "flex";
      twistAppContainer.style.opacity = "1";
    });
  </script>
</body>
</html>
